
<html lang="en">
<head>
	<meta charset=utf-8>
	<title>Testing</title>
	
    <link rel="stylesheet" href="style.css" />
</head>

<h1> <font color="white">Aerial Robotix Reporting tool </h1>

<body>
   <div id="message"></div>

   <h2> <input type="file" accept="video/*"/> </h2>
    
    <video controls autoplay></video>

    <canvas width="364" height="204"></canvas>

    <span class="button" id="snap" onclick="snap()">Take screenshot</button> </span>
    <span class="buttonS1" id="save" onclick="save()">Save</button> </span>

    <!-- Drop down menu --> 
    <select id="Criteria1">
      <option selected>Save as</option>
	  <option>Condition</option>
	  <option>Score</option>
	  <option>Repair</option>
	</select>

	<!-- Input box --> 
	<h3>
    	<div>
    	<textarea name="textarea" Id="Saveas" style="width:250px;height:50px;"></textarea>
    	</div>
    </h3>



    <!-- Javascript that handles uploading and playing video -->
	<script>
	//Playing the video 
    var URL = window.URL || window.webkitURL
	var playSelectedFile = function (event){
		var file = this.files[0]
		var videoNode = document.querySelector('video')
		var fileURL = URL.createObjectURL(file)
		videoNode.src = fileURL
	}
    
	var inputNode = document.querySelector('input')
	inputNode.addEventListener('change', playSelectedFile, false)

	// Handling size of video 
	var canvas = document.querySelector('canvas')
	var videoNode = document.querySelector('video')
	var context = canvas.getContext('2d');
	videoNode.setAttribute('height', '350')
	videoNode.setAttribute('width', '600')
    
	//Handline size of screenshot canvas
	var w, h, ratio;
		
	// Add a listener to wait for the 'loadedmetadata' state so the video's dimensions can be read
	videoNode.addEventListener('loadedmetadata', function() {
		// Calculate the ratio of the video's width to height
		ratio = 600/350;//videoNode.videoWidth / videoNode.videoHeight;
		// Define the required width as 100 pixels smaller than the actual video's width
		w = 600 - 100;//w - 100
		// Calculate the height based on the video's width and the ratio
		h = parseInt(w / ratio, 10);
		// Set the canvas width and height to the values just calculated
		
		canvas.width = w;
		canvas.height = h;			
	}, false);


    // Takes a snapshot of the video
	function snap() {
		// Define the size of the rectangle that will be filled (basically the entire element)
		context.fillRect(0, 0, w, h);
		// Grab the image from the video
		context.drawImage(videoNode, 0, 0, w, h);
		context.font = "17px Georgia";
		context.fillStyle = 'red';
	}

	function save() {
     
		var download = document.createElement('a');

		// Get details from user input
		var cval = document.getElementById("Saveas");
		var key1 = document.getElementById("Criteria1");
		var cr1 = key1.options[key1.selectedIndex].text;

		//Insert details to photo
		context.fillText(cr1.concat(": "), 2, canvas.height - 70);
		context.fillText(cval.value, 65, canvas.height - 70);

		var image_URL = canvas.toDataURL(videoNode); //URL for image
		download.href = image_URL;

		download.download = cval.value.concat('.png');
		download.click();

	}
	</script>


	   
    <footer>
		<small>&copy; copyright 2019, Aerial Robotix / developed by. Akwarandu Ugo Nwachuku / <a href="github.com/GermanInfinity">www.elephantsdream.org</a></small>
	</footer>
</body>
</html>